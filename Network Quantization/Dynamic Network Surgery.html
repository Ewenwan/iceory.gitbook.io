
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Dynamic Network Surgery · GitBook</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-splitter/splitter.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-back-to-top-button/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-etoc/plugin.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search-pro/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-highlight/website.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="Binary Weight Networks.html" />
    
    
    <link rel="prev" href="Incremental Network Quantization.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        
    
        <li class="chapter " data-level="1.1" data-path="../">
            
                <a href="../">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="Introduction.html">
            
                <a href="Introduction.html">
            
                    
                    Network Quantization
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="Incremental Network Quantization.html">
            
                <a href="Incremental Network Quantization.html">
            
                    
                    Incremental Network Quantization
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.2.2" data-path="Dynamic Network Surgery.html">
            
                <a href="Dynamic Network Surgery.html">
            
                    
                    Dynamic Network Surgery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="Binary Weight Networks.html">
            
                <a href="Binary Weight Networks.html">
            
                    
                    Binary Weight Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="Ternary Weight Networks.html">
            
                <a href="Ternary Weight Networks.html">
            
                    
                    Ternary Weight Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="Trained Ternary Quantization.html">
            
                <a href="Trained Ternary Quantization.html">
            
                    
                    Trained Ternary Quantization
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="Binarized Neural Networks.html">
            
                <a href="Binarized Neural Networks.html">
            
                    
                    Binarized Neural Networks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="Deep Compression.html">
            
                <a href="Deep Compression.html">
            
                    
                    Deep Compression
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="Integer Arithmetic Only Inference.html">
            
                <a href="Integer Arithmetic Only Inference.html">
            
                    
                    Integer Arithmetic Only Inference
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="../notes.html">
            
                <a href="../notes.html">
            
                    
                    Notes
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../notes/gitbook.html">
            
                <a href="../notes/gitbook.html">
            
                    
                    Install and Use Gitbook on Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../notes/manual_vs_auto_gradient.html">
            
                <a href="../notes/manual_vs_auto_gradient.html">
            
                    
                    Softmax Loss with Different Differentiation Methods
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../notes/pytorch_autograd.html">
            
                <a href="../notes/pytorch_autograd.html">
            
                    
                    PyTorch and Automatic Differentiation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.4" data-path="../notes/caffe2.html">
            
                <a href="../notes/caffe2.html">
            
                    
                    Install Caffe2 on Windows
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.5" data-path="../notes/markdown.html">
            
                <a href="../notes/markdown.html">
            
                    
                    Markdown Tutorial
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.6" data-path="../notes/vscode.html">
            
                <a href="../notes/vscode.html">
            
                    
                    VSCode
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.7" data-path="../notes/auxnet.html">
            
                <a href="../notes/auxnet.html">
            
                    
                    Re-implementation of AuxNet
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.8" data-path="../notes/git.html">
            
                <a href="../notes/git.html">
            
                    
                    Git
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.9" data-path="../notes/powerpoint.html">
            
                <a href="../notes/powerpoint.html">
            
                    
                    Power Point
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.10" data-path="../notes/pyplot.html">
            
                <a href="../notes/pyplot.html">
            
                    
                    PyPlot
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="../fun.md">
            
                <span>
            
                    
                    Fun
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../Some Thing Fun/HelloworldGame.html">
            
                <a href="../Some Thing Fun/HelloworldGame.html">
            
                    
                    HelloWorldGame
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../Some Thing Fun/基于CPLD的电梯仿真系统.html">
            
                <a href="../Some Thing Fun/基于CPLD的电梯仿真系统.html">
            
                    
                    基于CPLD的电梯仿真系统
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../Some Thing Fun/基于MFC的五子棋.html">
            
                <a href="../Some Thing Fun/基于MFC的五子棋.html">
            
                    
                    基于MFC的五子棋
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.4" data-path="../Some Thing Fun/cpp_table_v0.html">
            
                <a href="../Some Thing Fun/cpp_table_v0.html">
            
                    
                    基于c++的表格设计v0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.5" data-path="../Some Thing Fun/cpp_table_v1.html">
            
                <a href="../Some Thing Fun/cpp_table_v1.html">
            
                    
                    基于c++的表格设计v1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.6" data-path="../Some Thing Fun/cpp_table_v2.html">
            
                <a href="../Some Thing Fun/cpp_table_v2.html">
            
                    
                    基于c++的表格设计v2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.7" data-path="../Some Thing Fun/cpp_table_v3.html">
            
                <a href="../Some Thing Fun/cpp_table_v3.html">
            
                    
                    基于c++的表格设计v3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.8" data-path="../Some Thing Fun/CPP扫雷游戏.html">
            
                <a href="../Some Thing Fun/CPP扫雷游戏.html">
            
                    
                    CPP扫雷游戏
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.9" data-path="../Some Thing Fun/MFC简易音乐播放器.html">
            
                <a href="../Some Thing Fun/MFC简易音乐播放器.html">
            
                    
                    MFC简易音乐播放器
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.10" data-path="../Some Thing Fun/基于VB的二次曲线.html">
            
                <a href="../Some Thing Fun/基于VB的二次曲线.html">
            
                    
                    基于VB的二次曲线
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.11" data-path="../Some Thing Fun/基于VB的五子棋.html">
            
                <a href="../Some Thing Fun/基于VB的五子棋.html">
            
                    
                    基于VB的五子棋
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.12" data-path="../Some Thing Fun/基于VB的李萨如图形.html">
            
                <a href="../Some Thing Fun/基于VB的李萨如图形.html">
            
                    
                    基于VB的李萨如图形
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.13" data-path="../Some Thing Fun/机器人瓦力.html">
            
                <a href="../Some Thing Fun/机器人瓦力.html">
            
                    
                    机器人瓦力
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.14" data-path="../Some Thing Fun/简易语音识别设备.html">
            
                <a href="../Some Thing Fun/简易语音识别设备.html">
            
                    
                    简易语音识别设备
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Dynamic Network Surgery</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="dns-dynamic-network-surgery">DNS (Dynamic Network Surgery)</h1>
<!-- toc --><div id="toc" class="toc">

<ul>
<li><a href="#pruning-and-splicing">Pruning and Splicing</a><ul>
<li><a href="#important-tips">important tips</a></li>
</ul>
</li>
<li><a href="#implementation-in-pytorch">Implementation in PyTorch</a></li>
<li><a href="#experimental-results">Experimental Results</a></li>
</ul>

</div><!-- tocstop -->
<p><img src="fig/Overview of DNS.png" alt="Overview of DNS"></p>
<p>In this paper, the authors proposed dynamic network surgery to prune unimportant connections of the network. Different from previous methods, the proposed method contains two operations: <strong>pruning</strong> and <strong>splicing</strong>. Considering the complexity of deep neural networks, it is difficult to decide which connection is important and which one should be pruned. Thus the splicing operation is to recover the pruned weights that are found to be important during training phase. In contrary, weights are pruned with no chance to come back in previous methods, and that may lead to severe loss of accuracy.</p>
<h2 id="pruning-and-splicing">Pruning and Splicing</h2>
<p>Suppose <script type="math/tex; ">W_k</script> represents weights of a DNN model, and mask <script type="math/tex; ">T_k(i,j)\in \{0,1\}</script> denotes the states of connections of network. The optimize object can be formulated as follows:
<script type="math/tex; mode=display">
\min_{W_k, T_k} L(W_k\odot T_k)~s.t. T_k^{(i, j)}=h_k(W_k^{(i, j)}), \forall (i,j)\in \mathcal{I}, \tag{1}
</script>
where <script type="math/tex; ">L(\cdot)</script> denotes the loss function, <script type="math/tex; ">\odot</script> indicates the <a href="https://en.wikipedia.org/wiki/Hadamard_product_(matrices" target="_blank">Hadamard product operator</a>), <script type="math/tex; ">\mathcal{I}</script> represents every entry of weight matrixes and <script type="math/tex; ">h_k(W_k^{(i,j)})</script> evaluates the importance of connections in the network. The definition of <script type="math/tex; ">h_k</script> is shown as follows:
<script type="math/tex; mode=display">
h_k(W_k^{(i,j)}) = 
\begin{cases}
0 & if~a_k\gt|W_k^{(i,j)}| \\
T_k^{(i,j)}  & if~a_k\le |W_k^{(i,j)}| \lt b_k \\
1 & if~b_k\le |W_k^{(i,j)}|
\end{cases}\tag{2}
</script>
<script type="math/tex; ">a_k</script> and <script type="math/tex; ">b_k</script> in Equation (2) are two thresholds for improving the robustness of the proposed method. Note that if <script type="math/tex; ">|W_k^{(i,j)}|\in [a_k, b_k]</script>, the state of <script type="math/tex; ">T_k^{(i,j)}</script> would not be changed. This Equation is applied to the network to re-evaluate all the weights before training phase. Thus the pruned weights can be spliced if they are evaluated as important connections.</p>
<p>Further more, the thresholds <script type="math/tex; ">a_k</script> and <script type="math/tex; ">b_k</script> are computed by the following equations according to <a href="https://github.com/yiwenguo/Dynamic-Network-Surgery" target="_blank">source code</a> on GitHub:
<script type="math/tex; mode=display">
a_k = 0.9*(mean(W_k)+cRate*std(W_k)),\\
b_k = 1.1*(mean(W_k)+cRate*std(W_k)), \tag{3}
</script>
where <script type="math/tex; ">cRate</script> is the factor deciding the compressing rate of the model. Larger <script type="math/tex; ">cRate</script> leads to higher compression rate with more loss of accuracy.</p>
<p>After <script type="math/tex; ">T_k</script> is obtained by Equation (2), we can train the network with full training phase and update weights <script type="math/tex; ">W_k</script> with the following scheme:
<script type="math/tex; mode=display">
W_k^{i,j} \gets W_k^{(i,j)}-\beta \frac{\partial}{\partial(W_k^{(i,j)}T_k^{(i,j)})}L(W_k\odot T_k), \forall(i,j)\in \mathcal{I} \tag{4}
</script>
Considering the convergence of the proposed method, the authors suggest that the frequencies of pruning and splicing can be slowed down with a monotonically non-increasing function <script type="math/tex; ">\sigma(\cdot)</script> which indicates the probability of mask <script type="math/tex; ">T_k</script> that to be modified in single training iteration. With amount of training iterations, the value of <script type="math/tex; ">\sigma</script> may even decreased to zero, and the pruning and splicing to the network will be stopped.</p>
<h3 id="important-tips">important tips</h3>
<ul>
<li>The computation of thresholds only applied at the very beginning, and would not be change after that</li>
<li>Considering the gradient vanishing problem, the authors prune convolutional layers and fully connected layers separately, which is similar to <a href="http://papers.nips.cc/paper/5784-learning-both-weights-and-connections-for-efficient-neural-network.pdf" target="_blank">Han&apos;s paper</a></li>
<li>Pruned weights would also be updated during training</li>
</ul>
<h2 id="implementation-in-pytorch">Implementation in PyTorch</h2>
<p><strong>Prepare: </strong> pre-train a DNN model</p>
<p><strong>Step 1, pruning and splicing: </strong> compute <script type="math/tex; ">a_k</script> and <script type="math/tex; ">b_k</script> by Equation (3) and update mask <script type="math/tex; ">T_k</script> by Equation (2) with probability of <script type="math/tex; ">\sigma(iter)</script></p>
<p><strong>Step 2, training: </strong> adopt forward and backward propagation and compute Loss and Gradient</p>
<p><strong>Step 3, updating: </strong> update weights of the model with mask <script type="math/tex; ">T_k</script> using SGD</p>
<p><strong>Repeating: </strong> repeating step 1 to step 3 until the number of inter reaches its maximum</p>
<h2 id="experimental-results">Experimental Results</h2>
<p>The authors conducted experiments on several models including LeNet-5, LeNet-300-100 and AlexNet. The experimental results can be summarized as follows:</p>
<table>
<thead>
<tr>
<th>Model</th>
<th>Top-1 Error</th>
<th>Parameters</th>
<th>Iterations</th>
<th>Compression</th>
</tr>
</thead>
<tbody>
<tr>
<td>LeNet-5 reference</td>
<td>0.91%</td>
<td>431K</td>
<td>10K</td>
<td></td>
</tr>
<tr>
<td>LeNet-5 pruned</td>
<td>0.91%</td>
<td>4.0K</td>
<td>16K</td>
<td>108<script type="math/tex; ">\times</script></td>
</tr>
<tr>
<td>LeNet-100-300 reference</td>
<td>2.28%</td>
<td>267K</td>
<td>10K</td>
<td></td>
</tr>
<tr>
<td>LeNet-100-300 pruned</td>
<td>1.99%</td>
<td>4.8K</td>
<td>25K</td>
<td>56<script type="math/tex; ">\times</script></td>
</tr>
<tr>
<td>AlexNet reference</td>
<td>43.42%/-</td>
<td>61M</td>
<td>450K</td>
<td></td>
</tr>
<tr>
<td>AlexNet pruned</td>
<td>43.09%/19.99%</td>
<td>3.45M</td>
<td>700K</td>
<td>17.7<script type="math/tex; ">\times</script></td>
</tr>
</tbody>
</table>
<p>More detail comparison with work of Han et. al. on AlexNet using single crop validation on ImageNet are shown as follows:</p>
<table>
<thead>
<tr>
<th>Layer</th>
<th>Parameters</th>
<th>Remaining Parameters Rate of Han et. al.(%)</th>
<th>Remaining Parameters Rate(%)</th>
</tr>
</thead>
<tbody>
<tr>
<td>conv1</td>
<td>35K</td>
<td>~84%</td>
<td>53.8%</td>
</tr>
<tr>
<td>conv2</td>
<td>307K</td>
<td>~38%</td>
<td>40.6%</td>
</tr>
<tr>
<td>conv3</td>
<td>885K</td>
<td>~35%</td>
<td>29.0%</td>
</tr>
<tr>
<td>conv4</td>
<td>664K</td>
<td>~37%</td>
<td>32.3%</td>
</tr>
<tr>
<td>conv5</td>
<td>443K</td>
<td>~37%</td>
<td>32.5%</td>
</tr>
<tr>
<td>fc1</td>
<td>38M</td>
<td>~9%</td>
<td>3.7%</td>
</tr>
<tr>
<td>fc2</td>
<td>17M</td>
<td>~9%</td>
<td>6.6%</td>
</tr>
<tr>
<td>fc3</td>
<td>4M</td>
<td>~25%</td>
<td>4.6%</td>
</tr>
<tr>
<td>Total</td>
<td>61M</td>
<td>~11%</td>
<td>5.7%</td>
</tr>
</tbody>
</table>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="Incremental Network Quantization.html" class="navigation navigation-prev " aria-label="Previous page: Incremental Network Quantization">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="Binary Weight Networks.html" class="navigation navigation-next " aria-label="Next page: Binary Weight Networks">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Dynamic Network Surgery","level":"1.2.2","depth":2,"next":{"title":"Binary Weight Networks","level":"1.2.3","depth":2,"path":"Network Quantization/Binary Weight Networks.md","ref":"Network Quantization/Binary Weight Networks.md","articles":[]},"previous":{"title":"Incremental Network Quantization","level":"1.2.1","depth":2,"path":"Network Quantization/Incremental Network Quantization.md","ref":"Network Quantization/Incremental Network Quantization.md","articles":[]},"dir":"ltr"},"config":{"gitbook":"*","theme":"default","variables":{},"plugins":["mathjax","splitter","back-to-top-button","etoc","-search","-lunr","search-pro","livereload"],"pluginsConfig":{"etoc":{"h2lb":3,"header":1,"maxdepth":4,"mindepth":3,"notoc":false},"livereload":{},"splitter":{},"search-pro":{},"fontsettings":{"theme":"white","family":"sans","size":2},"highlight":{},"back-to-top-button":{},"mathjax":{"forceSVG":false,"version":"2.6-latest"},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"}},"file":{"path":"Network Quantization/Dynamic Network Surgery.md","mtime":"2017-06-24T08:32:51.723Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-03-13T03:12:57.214Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="https://cdn.mathjax.org/mathjax/2.6-latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-mathjax/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-splitter/splitter.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-back-to-top-button/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-etoc/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/jquery.mark.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search-pro/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-livereload/plugin.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

